<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Simple async sync example</title>
  </head>
  <body>
    <script>
      /*
        Fixing the problematic fetch() example below to make the three
        `console.log` statements appear in the desired order. Must run a
        local server to avoid CORS error.

        Instead of -> Starting, All done!, It worked :)
        Should log -> Starting, It worked :), All done!
 
        console.log ('Starting');
        let image;

        fetch('coffee.jpg').then((response) => {
          console.log('It worked :)')
          return response.blob();
        }).then((myBlob) => {
          let objectURL = URL.createObjectURL(myBlob);
          image = document.createElement('img');
          image.src = objectURL;
          document.body.appendChild(image);
        }).catch((error) => {
          console.log('There has been a problem with your fetch operation: ' + error.message);
        });

        console.log ('All done!');
      */

      // First solution, by adding the 'All Done!' to another chained then().
      // Or the second solution, by simply adding it to the second then().
      console.log ('Starting');
      let image;

      fetch('coffee.jpg').then((response) => {
        console.log('It worked :)')
        return response.blob();
      }).then((myBlob) => {
        let objectURL = URL.createObjectURL(myBlob);
        image = document.createElement('img');
        image.src = objectURL;
        document.body.appendChild(image);
        console.log('All Done!');
      // }).then(() => { 
      //   console.log('All Done!');
      }).catch((error) => {
        console.log('There has been a problem with your fetch operation: ' + error.message);
      });

    </script>
  </body>
</html>